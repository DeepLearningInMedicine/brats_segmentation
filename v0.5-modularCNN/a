Version 5 is converted into somewhat modular form.
